# Resolving merge conflicts

````admonish reset title="Reset your progress" collapsible=true
To reset your progress to the start of this chapter, run the following command:

```sh
curl https://s2p2.github.io/jj-for-everyone/reset.sh | bash -s conflict
cd ~/jj-tutorial/repo
```
````

After learning about loops, Alice wants to update her Python script.

```sh
jj new 'description("WIP: Add for loop")'
```

She fixes the incorrect loop syntax in `hello.py`.

```py
for _ in range(10):
    print("Hello, world!")
```

You can edit the file manually or run this command:

```sh
echo 'for _ in range(10):
    print("Hello, world!")' > hello.py
```

Then she commits the correction:

```sh
jj commit -m "Fix loop syntax"
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">z</span><span class="bold highlighted dimgray ">zlzryut</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-23 21:21:54</span><span class="bold "> </span><span class="bold highlighted blue ">5</span><span class="bold highlighted dimgray ">b7e967e</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
○  <span class="bold "></span><span class="bold purple ">o</span><span class="highlighted dimgray ">xnuoryz</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 21:21:54</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">c</span><span class="highlighted dimgray ">6042124</span>
│  Fix loop syntax
○  <span class="bold "></span><span class="bold purple ">t</span><span class="highlighted dimgray ">vrzpsvy</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 21:21:53</span> <span class="purple ">push-tvrzpsvypkqk</span> <span class="bold "></span><span class="bold blue ">6</span><span class="highlighted dimgray ">e468237</span>
│  WIP: Add for loop (need to fix syntax)
│ <span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">q</span><span class="highlighted dimgray ">uvtvrzl</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 21:21:54</span> <span class="purple ">main</span> <span class="bold "></span><span class="bold blue ">d</span><span class="highlighted dimgray ">0c3efcd</span>
│ │  Print German and French greetings as well
│ <span class="highlighted dimgray ">~</span>  <span class="highlighted dimgray ">(elided revisions)</span>
├─╯
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">k</span><span class="highlighted dimgray ">rymmwqm</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 21:21:53</span> <span class="bold "></span><span class="bold blue ">1</span><span class="highlighted dimgray ">581674f</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

## Creating a conflict

Alice now merges her changes into `main` with a new commit:

```sh
jj new main @-
```

<!-- generated by aha script -->
<pre class="aha">
Working copy  (@) now at: <span class="bold "></span><span class="bold highlighted purple ">s</span><span class="bold highlighted dimgray ">rpklysn</span><span class="bold "> </span><span class="bold highlighted blue ">0</span><span class="bold highlighted dimgray ">f64cf5a</span><span class="bold "> </span><span class="bold highlighted red ">(conflict)</span><span class="bold "> </span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span>
Parent commit (@-)      : <span class="bold "></span><span class="bold purple ">q</span><span class="highlighted dimgray ">uvtvrzl</span> <span class="bold "></span><span class="bold blue ">d</span><span class="highlighted dimgray ">0c3efcd</span> <span class="purple ">main</span><span class="highlighted dimgray "> | </span>Print German and French greetings as well
Parent commit (@-)      : <span class="bold "></span><span class="bold purple ">o</span><span class="highlighted dimgray ">xnuoryz</span> <span class="bold "></span><span class="bold blue ">c</span><span class="highlighted dimgray ">6042124</span> Fix loop syntax
Added 1 files, modified 2 files, removed 0 files
<span class="bold "></span><span class="bold yellow ">Warning: </span><span class="bold ">There are unresolved conflicts at these paths:</span>
hello.py    <span class="yellow ">2-sided conflict</span>
</pre>

This results in a **merge conflict**. The new commit is marked with `(conflict)` because both `main` and Alice's branch modified `hello.py`. Jujutsu cannot automatically combine these changes.

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold highlighted red ">@</span>    <span class="bold "></span><span class="bold highlighted purple ">l</span><span class="bold highlighted dimgray ">ozqokkt</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-23 21:34:35</span><span class="bold "> </span><span class="bold highlighted blue ">f</span><span class="bold highlighted dimgray ">e21ff1e</span><span class="bold "> </span><span class="bold highlighted red ">conflict</span><span class="bold "></span>
├─╮  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
│ ○  <span class="bold "></span><span class="bold purple ">o</span><span class="highlighted dimgray ">xnuoryz</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 21:21:54</span> <span class="bold "></span><span class="bold blue ">c</span><span class="highlighted dimgray ">6042124</span>
│ │  Fix loop syntax
│ ○  <span class="bold "></span><span class="bold purple ">t</span><span class="highlighted dimgray ">vrzpsvy</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 21:21:53</span> <span class="purple ">push-tvrzpsvypkqk</span> <span class="bold "></span><span class="bold blue ">6</span><span class="highlighted dimgray ">e468237</span>
│ │  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span> │  <span class="bold "></span><span class="bold purple ">q</span><span class="highlighted dimgray ">uvtvrzl</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 21:21:54</span> <span class="purple ">main</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">d</span><span class="highlighted dimgray ">0c3efcd</span>
│ │  Print German and French greetings as well
<span class="highlighted dimgray ">~</span> │  <span class="highlighted dimgray ">(elided revisions)</span>
├─╯
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">k</span><span class="highlighted dimgray ">rymmwqm</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 21:21:53</span> <span class="bold "></span><span class="bold blue ">1</span><span class="highlighted dimgray ">581674f</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

## Reading conflict markers

The conflicted file `hello.py` now contains markers showing the changes from both sides of the merge.

```
<<<<<<< Conflict 1 of 1
%%%%%%% Changes from base to side #1
 print("Hello, world!")
+print("Hallo, Welt!")
+print("Bonjour, le monde!")
+++++++ Contents of side #2
for _ in range(10):
    print("Hello, world!")
>>>>>>> Conflict 1 of 1 ends
```

The content between `<<<<<<<` and `>>>>>>>` shows the conflicting changes. The "side" numbers correspond to the order of the parent commits in the `jj new main @-` command.

*   **`side #1`** is `main` (the first parent). Its changes are shown in a diff format:
    *   `+` (plus sign): An added line.
    *   `-` (minus sign): A removed line. A modified line is shown as a `-` followed by a `+`.
    *   A space (` `): An unchanged line, shown for context.
*   **`side #2`** is `@-` (the second parent). Its section shows the final content from Alice's branch.

## Fixing a conflict

Resolving a conflict requires manually editing the file to the desired state, as an automatic merge is impossible. The correct outcome depends on intent.

````admonish note title="By example, there are three different reasonable merges of these changes" collapsible=true

1. Only repeat the English greeting:
    ```py
    for _ in range(10):
        print("Hello, world!")
    print("Hallo, Welt!")
    print("Bonjour, le monde!")
    ```

1. Repeat all languages and interleave them:
    ```py
    for _ in range(10):
        print("Hello, world!")
        print("Hallo, Welt!")
        print("Bonjour, le monde!")
    ```

1. Repeat all languages but keep them separate:
    ```py
    for _ in range(10):
        print("Hello, world!")
    for _ in range(10):
        print("Hallo, Welt!")
    for _ in range(10):
        print("Bonjour, le monde!")
    ```
````

Here, we'll combine the changes to repeat all greetings.

Replace the content of `hello.py` with the correct code, removing all conflict markers.

```sh
echo 'for _ in range(10):
    print("Hello, world!")
    print("Hallo, Welt!")
    print("Bonjour, le monde!")' > hello.py
```

With the file saved, the conflict is resolved. The `jj log` will no longer show the `(conflict)` marker.

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>    <span class="bold "></span><span class="bold highlighted purple ">kp</span><span class="bold highlighted dimgray ">rnqvtk</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-24 07:41:36</span><span class="bold "> </span><span class="bold highlighted blue ">b4</span><span class="bold highlighted dimgray ">6df36e</span><span class="bold "></span>
├─╮  <span class="bold "></span><span class="bold yellow ">(no description set)</span><span class="bold "></span>
│ ○  <span class="bold "></span><span class="bold purple ">t</span><span class="highlighted dimgray ">tuuwuvl</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-24 07:38:02</span> <span class="bold "></span><span class="bold blue ">c</span><span class="highlighted dimgray ">8479848</span>
│ │  Fix loop syntax
│ ○  <span class="bold "></span><span class="bold purple ">u</span><span class="highlighted dimgray ">xpxzolo</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-24 07:38:01</span> <span class="purple ">push-uxpxzoloznts</span> <span class="bold "></span><span class="bold blue ">b3</span><span class="highlighted dimgray ">26e556</span>
│ │  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span> │  <span class="bold "></span><span class="bold purple ">w</span><span class="highlighted dimgray ">ruksqvz</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-24 07:38:02</span> <span class="purple ">main</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">1</span><span class="highlighted dimgray ">18457e4</span>
│ │  Print German and French greetings as well
<span class="highlighted dimgray ">~</span> │  <span class="highlighted dimgray ">(elided revisions)</span>
├─╯
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">kr</span><span class="highlighted dimgray ">opmvym</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-24 07:38:01</span> <span class="bold "></span><span class="bold blue ">8</span><span class="highlighted dimgray ">c90e9fc</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

A conflict resolution is considered a change itself, so the commit isn't marked as "(empty)" like the first merge commit we made. Let's commit this and push to main:

```sh
jj commit -m "Merge repetition and translation of greeting"
jj bookmark move main --to @-
jj git push
```

```admonish info title="Conflicts during a rebase" collapsible=true
Conflicts can also occur during a rebase, but these are more complex to resolve. If you encounter one, for now, it's best to abort with `jj undo` and create a merge commit instead.
```

````admonish note title="Tools for conflict resolution" collapsible=true
While manually editing conflicted files always works, various tools can simplify the process.

Jujutsu has built-in tools like `:ours` and `:theirs` to quickly pick one side of a conflict and discard the other.

```sh
# keep "our" changes, throw away "theirs"
jj resolve --tool :ours
```
You can also integrate powerful external tools. For example, [Mergiraf](https://mergiraf.org/) resolves conflicts using the programming language's syntax tree. After installing it, run:
```sh
jj resolve --tool mergiraf
```
Jujutsu also supports custom [merge tool configurations](https://jj-vcs.github.io/jj/latest/config/#3-way-merge-tools-for-conflict-resolution).
````
