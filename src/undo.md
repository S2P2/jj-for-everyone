# Undoing mistakes

````admonish reset title="Reset your progress" collapsible=true
To reset your progress to the start of this chapter, run the following command:

```sh
curl https://jj-for-everyone.github.io/reset.sh | bash -s undo
cd ~/jj-tutorial/repo
```
````

What we've learned so far can go a long way - until something goes wrong.
For example, assume you ran `jj commit` and hastily entered a sloppy commit message.
Now you'd like to go back and improve it.

With our current skill set, it's impossible to edit the description of a commit after we ran `jj commit`.
But what if we could simply **undo** a change we made to the repository?
Travel back in time?
Turns out we can, because Jujutsu stores not only a version history of our project in the form of commits, but it also keeps a log of all operations that were performed on the repository itself.
There are some low-level commands to inspect this "operation log" and restore the repository to a specific state in time.
For now though, I will only teach you about the high-level commands to undo and redo operations one-by-one.

````admonish warning title="This chapter requires at least Jujutsu version 0.33"
The commands we're going to run behave slightly differently with older versions.
If you have an older one (check with `jj --version`), please update to a more recent version before continuing.

If you installed Jujutsu with `mise` as recommended in the [installation](install.md) chapter, you can update using the following commands:
```sh
mise install-into jujutsu@latest /tmp/jj-install
mv /tmp/jj-install/jj ~/.local/bin
rm -rf /tmp/jj-install
```
````

Let's remind ourselves what the state of our repo looks like

```sh
cd ~/jj-tutorial/repo
jj log
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">m</span><span class="bold highlighted dimgray ">vwvstxp</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-21 05:08:40</span><span class="bold "> </span><span class="bold highlighted blue ">e7</span><span class="bold highlighted dimgray ">c0e5c3</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">u</span><span class="highlighted dimgray ">ttrxvpr</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-08-21 05:08:40</span> <span class="purple ">main</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">c</span><span class="highlighted dimgray ">43f2325</span>
│  Add submission instructions
│ ○  <span class="bold "></span><span class="bold purple ">v</span><span class="highlighted dimgray ">rzlxpqt</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-21 05:08:40</span> <span class="purple ">push-vrzlxpqtwosl</span> <span class="bold "></span><span class="bold blue ">e2</span><span class="highlighted dimgray ">1774c2</span>
├─╯  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">q</span><span class="highlighted dimgray ">wxuxqlr</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-21 05:08:40</span> <span class="bold "></span><span class="bold blue ">4</span><span class="highlighted dimgray ">6c18f61</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

## Making a mistake

Let's change something, so we can create a commit with a sloppy description.
Why not greet the world in a few more languages:

```sh
echo "print('Hallo, Welt!')" >> hello.py
echo "print('Bonjour, le monde!')" >> hello.py
```

Now let's create that commit with a bad description:

```sh
jj commit -m "code improvements"
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">qm</span><span class="bold highlighted dimgray ">uzoxnq</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-23 18:43:25</span><span class="bold "> </span><span class="bold highlighted blue ">5</span><span class="bold highlighted dimgray ">9a200dc</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
○  <span class="bold "></span><span class="bold purple ">n</span><span class="highlighted dimgray ">qktzmsp</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:43:25</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">3</span><span class="highlighted dimgray ">8be9036</span>
│  code improvements
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">wtknypl</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-08-23 12:19:05</span> <span class="purple ">main</span> <span class="bold "></span><span class="bold blue ">e</span><span class="highlighted dimgray ">a6c4eeb</span>
│  Add submission instructions
│ ○  <span class="bold "></span><span class="bold purple ">l</span><span class="highlighted dimgray ">ttonqou</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 12:19:05</span> <span class="purple ">push-lttonqouuwuo</span> <span class="bold "></span><span class="bold blue ">1</span><span class="highlighted dimgray ">ebfde14</span>
├─╯  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">qp</span><span class="highlighted dimgray ">tuspzk</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 12:19:05</span> <span class="bold "></span><span class="bold blue ">6</span><span class="highlighted dimgray ">fbc981e</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

## Undoing the mistake

Realizing our mistake, we'd like to fix it now.
We can restore the state of our repository to a previous point by running:

```sh
jj undo
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">n</span><span class="bold highlighted dimgray ">qktzmsp</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-23 18:42:30</span><span class="bold "> </span><span class="bold highlighted blue ">8</span><span class="bold highlighted dimgray ">161ec3f</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold yellow ">(no description set)</span><span class="bold "></span>
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">wtknypl</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-08-23 12:19:05</span> <span class="purple ">main</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">e</span><span class="highlighted dimgray ">a6c4eeb</span>
│  Add submission instructions
│ ○  <span class="bold "></span><span class="bold purple ">l</span><span class="highlighted dimgray ">ttonqou</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 12:19:05</span> <span class="purple ">push-lttonqouuwuo</span> <span class="bold "></span><span class="bold blue ">1</span><span class="highlighted dimgray ">ebfde14</span>
├─╯  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">q</span><span class="highlighted dimgray ">ptuspzk</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 12:19:05</span> <span class="bold "></span><span class="bold blue ">6</span><span class="highlighted dimgray ">fbc981e</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

Great!
We're back to the state before we wrote the bad commit message.
Now we get a second chance to write a better one:

```sh
jj commit -m "Print German and French greetings as well"
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">rv</span><span class="bold highlighted dimgray ">zkmmpr</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-09-09 21:57:25</span><span class="bold "> </span><span class="bold highlighted blue ">5</span><span class="bold highlighted dimgray ">ecb4fe3</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
○  <span class="bold "></span><span class="bold purple ">s</span><span class="highlighted dimgray ">tsyzzsl</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-09-09 21:57:25</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">8</span><span class="highlighted dimgray ">06ab554</span>
│  Print German and French greetings as well
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">ru</span><span class="highlighted dimgray ">plmxpz</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-09-09 21:56:34</span> <span class="purple ">main</span> <span class="bold "></span><span class="bold blue ">b</span><span class="highlighted dimgray ">514a3a4</span>
│  Add submission instructions
│ ○  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">rsrsvmy</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-09-09 21:56:34</span> <span class="purple ">push-zrsrsvmyvozk</span> <span class="bold "></span><span class="bold blue ">f</span><span class="highlighted dimgray ">e211fc6</span>
├─╯  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">k</span><span class="highlighted dimgray ">tsvrvwu</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-09-09 21:56:34</span> <span class="bold "></span><span class="bold blue ">d</span><span class="highlighted dimgray ">c65c065</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

## Going further back

What happens if you make a mistake, then you do something else, and only later you realize your mistakes?
Can you undo multiple operations?
Sure you can!
It works exactly like the "undo" feature of typical graphical applications (which you may be used to using by pressing <kbd>Ctrl+Z</kbd>).
Every time you run `jj undo`, you take one step further into the past.
Let's try it a couple of times.

The last thing we did was run `jj commit`, so running `jj undo` again will put the repository in the state before that:

```sh
jj undo
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">p</span><span class="bold highlighted dimgray ">sqzqsyx</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-23 18:47:59</span><span class="bold "> </span><span class="bold highlighted blue ">e</span><span class="bold highlighted dimgray ">e29bb33</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold yellow ">(no description set)</span><span class="bold "></span>
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">l</span><span class="highlighted dimgray ">vtqysnn</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="purple ">main</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">2</span><span class="highlighted dimgray ">a6d89f8</span>
│  Add submission instructions
│ ○  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">wmzptsw</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="purple ">push-zwmzptswtkly</span> <span class="bold "></span><span class="bold blue ">7</span><span class="highlighted dimgray ">3c28593</span>
├─╯  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">u</span><span class="highlighted dimgray ">ytpymws</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="bold "></span><span class="bold blue ">d</span><span class="highlighted dimgray ">a90dfce</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

Next, what did we do before running `jj commit`?
We modified the file `hello.py`.
While we didn't use Jujutsu to do that, it was still recorded as a separate operation on the repository.
Every `jj` command you run will first check the files in your repository and detect if any of them were changed.
If changes are detected, they will be recorded as a separate operation (called a _snaphot_).
That way, you can `jj undo` those file changes separately from any action you took with a `jj` command.

Let's observe what happens to the content of `hello.py` when we run `jj undo`:

```py
# hello.py
print('Hello, world!')
print('Hallo, Welt!')
print('Bonjour, le monde!')
```

```sh
jj undo
```

```py
# hello.py
print('Hello, world!')
```

```admonish warning
What happens if you create a file and then delete it without running any `jj` commands in between?
Jujutsu didn't get the chance to create a snapshot which stores the content of that file.
Therefore, it's impossible to get the file back using `jj undo`.
```

Here's what the log looks like now:

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">p</span><span class="bold highlighted dimgray ">sqzqsyx</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-23 18:47:34</span><span class="bold "> </span><span class="bold highlighted blue ">4</span><span class="bold highlighted dimgray ">110d386</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">l</span><span class="highlighted dimgray ">vtqysnn</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="purple ">main</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">2</span><span class="highlighted dimgray ">a6d89f8</span>
│  Add submission instructions
│ ○  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">wmzptsw</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="purple ">push-zwmzptswtkly</span> <span class="bold "></span><span class="bold blue ">7</span><span class="highlighted dimgray ">3c28593</span>
├─╯  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">u</span><span class="highlighted dimgray ">ytpymws</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="bold "></span><span class="bold blue ">d</span><span class="highlighted dimgray ">a90dfce</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

We're going to run `jj undo` one last time.
What did we do before modifying `hello.py`?
You might not remember, because it was in the previous chapter.
Let's just have a look:

```sh
jj undo
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">m</span><span class="bold highlighted dimgray ">xzkoqwk</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-09-09 22:45:31</span><span class="bold "> </span><span class="bold highlighted blue ">b</span><span class="bold highlighted dimgray ">2a169da</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
│ <span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">s</span><span class="highlighted dimgray ">xyvmurm</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-09-09 22:45:31</span> <span class="purple ">main</span> <span class="bold "></span><span class="bold blue ">66</span><span class="highlighted dimgray ">b98392</span>
│ │  Add submission instructions
│ │ ○  <span class="bold "></span><span class="bold purple ">qt</span><span class="highlighted dimgray ">swwqou</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-09-09 22:45:31</span> <span class="purple ">push-qtswwqouunyn</span> <span class="bold "></span><span class="bold blue ">3</span><span class="highlighted dimgray ">4226bb8</span>
│ ├─╯  WIP: Add for loop (need to fix syntax)
│ <span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">qn</span><span class="highlighted dimgray ">rkqssy</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-09-09 22:45:31</span> <span class="bold "></span><span class="bold blue ">6d</span><span class="highlighted dimgray ">59757b</span>
╭─┤  <span class="green ">(empty)</span> Merge code and documentation for hello-world
│ │
│ ~
│
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">tsqoyom</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-09-09 22:45:31</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">c</span><span class="highlighted dimgray ">fa89f28</span>
│  Document hello.py in README.md
~
</pre>

Ah, yes.
We were practicing navigating the history.
After that, we ran `jj new main` to get back on the main branch.
`jj undo` reverted that and brought us to the state of the old commit.

Now, that was good practice for `jj undo`, but the three operations we just undid weren't actually mistakes.
Can we get them back?
In a typical graphical application, you might do that by clicking on a "redo" button or by pressing <kbd>Ctrl+Shift+Z</kbd>.
With Jujutsu, you run the command `jj redo`.
Let's do it three times to get back to our most recent state:

```sh
jj redo
jj redo
jj redo
```

<!-- generated by aha script -->
<pre class="aha">
<span class="bold "></span><span class="bold green ">@</span>  <span class="bold "></span><span class="bold highlighted purple ">x</span><span class="bold highlighted dimgray ">urwwlyw</span><span class="bold "> </span><span class="bold yellow ">alice@local</span><span class="bold "> </span><span class="bold highlighted cyan ">2025-08-23 18:48:08</span><span class="bold "> </span><span class="bold highlighted blue ">a</span><span class="bold highlighted dimgray ">510f1a7</span><span class="bold "></span>
│  <span class="bold "></span><span class="bold highlighted green ">(empty)</span><span class="bold "> </span><span class="bold highlighted green ">(no description set)</span><span class="bold "></span>
○  <span class="bold "></span><span class="bold purple ">p</span><span class="highlighted dimgray ">sqzqsyx</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:48:08</span> <span class="green ">git_head()</span> <span class="bold "></span><span class="bold blue ">c</span><span class="highlighted dimgray ">51eb57e</span>
│  Print German and French greetings as well
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">l</span><span class="highlighted dimgray ">vtqysnn</span> <span class="yellow ">bob@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="purple ">main</span> <span class="bold "></span><span class="bold blue ">2</span><span class="highlighted dimgray ">a6d89f8</span>
│  Add submission instructions
│ ○  <span class="bold "></span><span class="bold purple ">z</span><span class="highlighted dimgray ">wmzptsw</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="purple ">push-zwmzptswtkly</span> <span class="bold "></span><span class="bold blue ">7</span><span class="highlighted dimgray ">3c28593</span>
├─╯  WIP: Add for loop (need to fix syntax)
<span class="bold "></span><span class="bold highlighted cyan ">◆</span>  <span class="bold "></span><span class="bold purple ">u</span><span class="highlighted dimgray ">ytpymws</span> <span class="yellow ">alice@local</span> <span class="cyan ">2025-08-23 18:47:34</span> <span class="bold "></span><span class="bold blue ">d</span><span class="highlighted dimgray ">a90dfce</span>
│  <span class="green ">(empty)</span> Merge code and documentation for hello-world
~
</pre>

If you were to run `jj redo` one more time, you'd get an error telling you there's nothing to redo.

## Overwriting undone states

Remember the bad commit message we wrote?
It was "code improvements".
We'll, it's now impossible to get that commit back with only `jj undo` and `jj redo`.
If you create new states after having undone some others, those "undone" states will become "hidden".
This is exactly how the "undo" feature of typical graphical applications works, so you may not be surprised by this.

Unlike graphical applications, Jujutsu has more advanced commands to get even those states back.
That's a topic for another day though.

## Pushes to the remote can't be undone

Sending commits to the remote by pushing a bookmark is technically a normal operation on the repository.
Undoing such operations is almost always a bad idea though.
It doesn't tell the remote to restore its previous state, the remote is left intact.
The only thing `jj undo` does in that situation is _forget that commits were pushed to the remote_.
This can lead to pretty nasty errors the next time you try to fetch from or push to the remote.

The most frequent errors that can happen include "conflicted bookmarks" and "divergent change IDs".
Both of these problems can be solved, but now's not the right time for me to teach you _how_.
So, take my advice and _just don't do that_.

If you accidentally undid a `jj git push` operation, just `jj redo` it and you should be fine.

In the future, `jj undo` may outright refuse to undo operations that interacted with the remote.

## Repository history is not backed up to the remote

Deleting a repository locally is not a big deal if you have a remote.
Just clone the repo again and you'll have all of your commit history back.
However, that's not the case for the history of operations you made on the repository.
That history is local only.
So, `jj undo` works at most as far back as the state of when you cloned the repo.
